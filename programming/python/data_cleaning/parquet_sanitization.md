# サニタイズ
サニタイズは**データのおそうじ＆安全パック**。  
よごれ（変な値）やバイ菌（危険な文字）を取りのぞいて、**機械が読みやすく・こわれにくく**する作業！  

## なんのため？

* **エラーを防ぐ**（保存や計算でコケない）
* **形をそろえる**（みんな同じきまりでキレイ！）
* **あぶない文字を無力化**（いたずら対策）

## よくやるおそうじ例

* `bytes`
    * **文字**に直す
    * UTF-8でデコード
    * ダメなら置換して`�`に
* `NaN`/空文字
    * **None** に統一（欠損の表現をそろえる）
* `"  りんご  "`
    * **前後の空白をカット**して `"りんご"`
* `"42"`（文字）
    * **42**（数）に直す
* `"<script>"` みたいな**危険な記号はエスケープ**して表示用に

## ミニ例（イメージ）

```python
dirty = [b"hello", " 42 ", None, "oops\xff"]
# おそうじすると…
clean = ["hello", "42", None, "oops�"]
```

## いつやる？

* **保存前**（CSV/Parquet/DB に書く前）
* **外から来た入力**（API/フォーム/ファイル）
* **ログ出力や表示前**

## `�`について
**Unicodeの「置換文字」(U+FFFD, REPLACEMENT CHARACTER)** 。  
コンピュータが「この文字は読めない／壊れてる！」と判断したとき、**読めない部分の代わり**に入れます。  

### なんで出るの？

* **エンコーディング不一致**（例：本当は Shift\_JIS なのに UTF-8 として読んだ）
* **途中で壊れたバイト列**（欠損・切れたファイル）
* わざと `errors="replace"` でデコードした

例：
```python
b = b"hello\xffworld"             # \xff はUTF-8として不正
s = b.decode("utf-8", errors="replace")
print(s)  # hello�world   ← 読めない所が � に
```

### どう対処する？

1. **正しいエンコーディングで読む**（最善）

   * `pandas.read_csv(..., encoding="cp932")` など
   * 原本が UTF-8 か Shift\_JIS かをまず確認

2. **自動判定を使う**（不明なら）

   * `charset-normalizer` / `chardet` で推定 → その結果で `decode`

3. **置換の代わりに無視**（必要なら）

   * `decode(..., errors="ignore")`（ただし情報は失われる）

4. **発生箇所を検知・ログ**

   * `s.count("\ufffd")` で `�` の数を数える
   * 列全体なら：

     ```python
     has_replacement = df["col"].str.contains("\ufffd")
     problem_rows = df[has_replacement]
     ```

### 似て非なるもの

* **豆腐（□）表示**：フォントがその文字の**見た目を持ってない**だけ
* **`�`**：**デコードに失敗**して“読めない”と判定された証

---

### まとめ

`�` は「読めない文字の身代わり」。
**正しいエンコーディングで読む**のが根本解決、どうしても不明なら推定→`errors=`の方針でコントロールしましょう。
