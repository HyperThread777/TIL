---
title: "Polarsでの欠損値確認"
date_created: 2025-08-14
tags:
  - python
  - polars
---

# 概要

Polarsでの欠損値確認方法。

# 詳細

## 1. 列ごとの欠損数・欠損率
```python
import polars as pl

def missing_report(df: pl.DataFrame) -> pl.DataFrame:
    n = df.height
    # 列ごとの欠損数を1行DataFrameで取得
    nc = df.null_count()
    # 列順どおりに値を取り出す
    null_counts = [nc[0, c] for c in df.columns]
    non_nulls   = [n - x for x in null_counts]
    rates       = [(x / n) * 100 if n else 0.0 for x in null_counts]

    return pl.DataFrame({
        "column": df.columns,
        "dtype":  [str(dt) for dt in df.dtypes],
        "non_null": non_nulls,
        "nulls": null_counts,
        "null_%": rates,
    }).sort("nulls", descending=True)

# 使い方
summary = missing_report(df_price)
print(summary)
```
ポイント:
- `df.null_count()` が列ごとの欠損数を返します（1行の DataFrame）。
- 非欠損数（non-null）と欠損率も合わせて見られるよう整形。

## 2. 行ごとに「どこか1列でも欠損がある」行の件数・抽出

```python
# 欠損を1つでも含む行の件数
rows_with_any_null = df_price.select(
    pl.any_horizontal(pl.col("*").is_null()).sum().alias("rows_with_null")
).item()
print(rows_with_any_null)

# 欠損を1つでも含む行のサンプル（先頭20行）
rows_with_null_df = df_price.filter(pl.any_horizontal(pl.col("*").is_null()))
print(rows_with_null_df.head(20))
```
ポイント:
- `pl.any_horizontal(...)` は “行方向に OR” を取る関数です。
- `is_null()` を全列に当てて、「1つでも True ならその行は欠損あり」。